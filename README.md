# VirusMutationsAI
Welcome to VirusMutationsAI - a web-dashboard with smart routines to analyze genomes of viruses.
Current implementation allows to search articles for mutations at the SARS-CoV-2 virus genome.


## Local development

### Frontend
We use [Yarn](https://yarnpkg.com/) as a package manager. Consider installing it globally.

#### Dependencies
Change directory to `frontend` and run `yarn` there.

#### Development server
Run `ng serve` for a dev server. Navigate to `http://localhost:4200/`.

### Database
We use [PostgreSQL](https://www.postgresql.org/) as a relational database.

### Backend
This project requires [Python 3.8](https://python.org/).

We use [Poetry](https://python-poetry.org/) as a package manager. Consider installing it globally.

#### Dependencies
Change directory to `backend2` and run `poetry install` there.

#### Development server
Configure environment variables.

Change directory to `backend2` and run `alembic upgrade head` to upgrade database to current state.

Run `uvicorn src.main:app` for a dev server.
Navigate to `http://localhost:8000/docs` to see Open API docs.


## Docker

### Build images

#### Frontend
Run the following command in the root directory of the repo:

`docker build -t <tag> -f docker/frontend/Dockerfile .`

The image exposes port `80`.

Frontend app can be configured via environment variables.

| Variable | Description | Required | Example |
| -------  | ----------- | -------- | ------- |
| API2_URL | Backend API URL | y | `http://localhost:8000/api/` |

#### Backend 2
Run the following command in the root directory of the repo:

`docker build -t <tag> -f docker/backend2/Dockerfile .`

The image exposes port `8000` by default.

The image uses a volume to permanently store GMail credentials.
By default it points to `/credentials/gmail`. 

Backend app can be configured via environment variables.

| Variable | Description | Required | Example |
| -------  | ----------- | -------- | ------- |
| PROJECT_NAME | Open API Title | n | `Virus Mutations AI API` |
| ACCESS_TOKEN_URL | Authentication URL for Swagger | n | `http://localhost:3000/api/login` |
| API_V1_STR | API version 1 prefix | n | `/api/v1` |
| SECRET_KEY | JWT key | y | `VerySecretString` |
| ACCESS_TOKEN_EXPIRE_MINUTES | JWT expiration time in minutes | n | `1440` |
| CORS_ORIGINS | JSON-formatted list of origins | n | `["http://localhost:4200", "http://127.0.0.1:4200"]` |
| PUBLIC_URL | Site address used in links in emails  | y | `http://localhost` |
| POSTGRES_SERVER | | n | `172.17.0.1` |
| POSTGRES_PORT | | n | `5432` |
| POSTGRES_USER | | n | `username` |
| POSTGRES_PASSWORD | | n | `password` |
| POSTGRES_DB | | n | `covid` |
| SQLALCHEMY_DATABASE_URI | | n | `postgres://username:password@server/db` |
| LOG_QUERIES | Log SQL queries | n | `False` |
| ENTREZ_EMAIL | Email to be used to access the Entrez DB | y | `mail@example.com` |
| EMAIL_FROM | Email for outgoing messages  | y | `mail@example.com` |
| GMAIL_CREDENTIALS_PATH | Path in container to JSON file generated by the login command | y | `/path/to/gmail-credentials.json` |

### Run the app using [Docker Compose](https://docs.docker.com/compose/)
See [docker-compose.yml](docker/docker-compose.yml) in the docker directory.
